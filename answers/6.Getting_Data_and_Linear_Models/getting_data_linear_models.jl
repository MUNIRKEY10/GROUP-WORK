# Julia code for \"Getting Data and Linear Models\"\nusing DataFrames\nusing CSV\nusing Statistics\nusing Plots\nusing HypothesisTests\nusing GLM\nusing CategoricalArrays # For factor equivalents\nusing Serialization # For saving/loading Julia objects\n\n# --- Loading and Saving Julia Objects (equivalent to R\\'s save/load) ---\n# The gmp.dat file should have been created in a previous step and read into gmp_df.\n# Create a dummy gmp DataFrame for demonstration\ngmp_df_julia = DataFrame(gmp = collect(100:100:2000), pcgmp = [10, 15, 18, 20, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37])\ngmp_df_julia.MSA = [\"MSA_$(i)\" for i in 1:nrow(gmp_df_julia)]\ngmp_df_julia.pop = round.(Int, gmp_df_julia.gmp ./ gmp_df_julia.pcgmp)\n\n# Save gmp_df_julia to a file using Serialization\nserialize(\"gmp.jls\", gmp_df_julia)\n\n# Remove gmp_df_julia from current scope to demonstrate loading\ndel gmp_df_julia\n# println(@isdefined gmp_df_julia) # Check if gmp_df_julia is defined (should be false)\n\n# Load gmp_df_julia from the file\ngmp_loaded_julia = deserialize(\"gmp.jls\")\nprintln(names(gmp_loaded_julia))\nprintln(first(gmp_loaded_julia, 5))\n\n# No direct equivalent for R\\'s data() function for arbitrary packages.\n# Creating a dummy \'cats\' dataframe for illustration based on R\'s summary:\ncats_data_julia = DataFrame(Sex = vcat(fill(\"F\", 47), fill(\"M\", 97)),\n                              Bwt = randn(144) .* 0.5 .+ 2.724,\n                              Hwt = randn(144) .* 3.0 .+ 10.63)\n\n# Convert Sex to Categorical\ncats_data_julia.Sex = categorical(cats_data_julia.Sex)\nprintln(describe(cats_data_julia))\n\n# --- Reading and Writing Dataframes ---\n# Example of writing a CSV\nCSV.write(\"gmp_julia.csv\", gmp_loaded_julia)\n\n# --- Exploring and Preparing Birth Weight Data ---\n# Manually create birthwt dataframe based on R\'s MASS::birthwt structure.\n# This is a simplified representation.\nbirthwt_julia = DataFrame(
    low = rand(0:1, 189),
    age = rand(14:45, 189),
    lwt = rand(80:250, 189),
    race = rand(1:3, 189),
    smoke = rand(0:1, 189),
    ptl = rand(0:3, 189),
    ht = rand(0:1, 189),
    ui = rand(0:1, 189),
    ftv = rand(0:6, 189),
    bwt = rand(709:4990, 189),
)\n\n# Make it readable: Rename columns\nrename!(birthwt_julia, 
        :low => :birthwt_below_2500,
        :age => :mother_age,
        :lwt => :mother_weight,
        :smoke => :mother_smokes,
        :ptl => :previous_prem_labor,
        :ht => :hypertension,
        :ui => :uterine_irr,
        :ftv => :physician_visits,
        :bwt => :birthwt_grams)\n\n# Make it readable: Recode factors\nbirthwt_julia.race = categorical(map(x -> x == 1 ? \"white\" : (x == 2 ? \"black\" : \"other\"), birthwt_julia.race))\nbirthwt_julia.mother_smokes = categorical(map(x -> x == 0 ? \"No\" : \"Yes\"), birthwt_julia.mother_smokes)\nbirthwt_julia.uterine_irr = categorical(map(x -> x == 0 ? \"No\" : \"Yes\"), birthwt_julia.uterine_irr)\nbirthwt_julia.hypertension = categorical(map(x -> x == 0 ? \"No\" : \"Yes\"), birthwt_julia.hypertension)\n\nprintln(describe(birthwt_julia))\n\n# Explore it with plots\nplot() # Initialize a plot for pdf saving\n Plots.histogram(birthwt_julia.race, title=\"Count of Mother\'s Race in Springfield MA, 1986\", xlabel=\"Race\", ylabel=\"Count\", legend=false)\nsavefig(\"birthwt_race_plot.pdf\")\n\nPlots.histogram(birthwt_julia.mother_age, title=\"Mother\'s Ages in Springfield MA, 1986\", xlabel=\"Mother\'s Age\", ylabel=\"Frequency\", legend=false)\nsavefig(\"birthwt_mother_age_plot.pdf\")\n\nplot(sort(birthwt_julia.mother_age), seriestype=:line, title=\"(Sorted) Mother\'s Ages in Springfield MA, 1986\", ylabel=\"Mother\'s Age\", xlabel=\"Index\", legend=false)\nsavefig(\"birthwt_mother_age_sorted_plot.pdf\")\n\nPlots.scatter(birthwt_julia.mother_age, birthwt_julia.birthwt_grams, title=\"Birth Weight by Mother\'s Age in Springfield MA, 1986\",\n              xlabel=\"Mother\'s Age\", ylabel=\"Birth Weight (g)\", legend=false)\nsavefig(\"birthwt_age_vs_grams_plot.pdf\")\n\nPlots.boxplot(birthwt_julia.mother_smokes, birthwt_julia.birthwt_grams, title=\"Birth Weight by Mother\'s Smoking Habit\",\n              xlabel=\"Mother Smokes\", ylabel=\"Birth Weight (g)\", legend=false)\nsavefig(\"birthwt_smokes_vs_grams_plot.pdf\")\n\n# --- Basic Statistical Testing (Linear Models) ---\n# Two-sample t-test\nsmokers_bwt = birthwt_julia[birthwt_julia.mother_smokes .== \"Yes\", :birthwt_grams]\nnonsmokers_bwt = birthwt_julia[birthwt_julia.mother_smokes .== \"No\", :birthwt_grams]\nht = UnequalVarianceTTest(smokers_bwt, nonsmokers_bwt)\nprintln(ht)\n\n# Linear model with smoking\nlinear_model_1_julia = lm(@formula(birthwt_grams ~ mother_smokes), birthwt_julia)\nprintln(linear_model_1_julia)\nprintln(coeftable(linear_model_1_julia))\n\n# Linear model with age\nlinear_model_2_julia = lm(@formula(birthwt_grams ~ mother_age), birthwt_julia)\nprintln(linear_model_2_julia)\nprintln(coeftable(linear_model_2_julia))\n\n# Plot diagnostics for linear_model_2_julia (Julia equivalent for diagnostic plots are more involved)\n# This would typically involve manually extracting residuals and fitted values.\n# No direct 4-plot equivalent, but individual plots can be made.\n# For simplicity, we\'ll skip saving diagnostic plots in Julia for now, as it requires more manual work.\n\n# Detecting Outliers: remove mother.age > 40\nbirthwt_noout_julia = filter(row -> row.mother_age <= 40, birthwt_julia)\nlinear_model_3_julia = lm(@formula(birthwt_grams ~ mother_age), birthwt_noout_julia)\nprintln(linear_model_3_julia)\nprintln(coeftable(linear_model_3_julia))\n\n# More complex models\n# Add smoking behavior to age model\nlinear_model_3a_julia = lm(@formula(birthwt_grams ~ mother_smokes + mother_age), birthwt_noout_julia)\nprintln(coeftable(linear_model_3a_julia))\n\n# Add race and interaction to age + smoking model\nlinear_model_3b_julia = lm(@formula(birthwt_grams ~ mother_age + mother_smokes * race), birthwt_noout_julia)\nprintln(coeftable(linear_model_3b_julia))\n\n# Including everything (excluding redundant outcome variable)\n# The . notation in R for formula is not directly supported in GLM.jl in the same way.\n# Need to explicitly list predictors. birthwt_below_2500 is not included\nformula_all_julia = @formula(birthwt_grams ~ mother_age + mother_weight + race + mother_smokes + previous_prem_labor + hypertension + uterine_irr + physician_visits)\nlinear_model_4a_julia = lm(formula_all_julia, birthwt_noout_julia)\nprintln(coeftable(linear_model_4a_julia))\n\n# --- Generalized Linear Models (GLM) ---\n# GLM with Gaussian family (equivalent to lm)\nglm_0_julia = glm(formula_all_julia, birthwt_noout_julia, Gaussian())\nprintln(coeftable(glm_0_julia))\n\n# GLM with Binomial family (for binary outcome: birthwt_below_2500)\n# Formula for binary outcome\nformula_binary_julia = @formula(birthwt_below_2500 ~ mother_age + mother_weight + race + mother_smokes + previous_prem_labor + hypertension + uterine_irr + physician_visits)\nglm_1_julia = glm(formula_binary_julia, birthwt_noout_julia, Binomial())\nprintln(coeftable(glm_1_julia))\n\n# --- Prediction ---\n# Split data into training and test sets\n# For reproducibility\nRandom.seed!(42)\nshuffled_indices_julia = shuffle(1:nrow(birthwt_noout_julia))\nodd_indices_julia = shuffled_indices_julia[1:2:end]\neven_indices_julia = shuffled_indices_julia[2:2:end]\n\nbirthwt_in_julia = birthwt_noout_julia[odd_indices_julia, :]\nbirthwt_out_julia = birthwt_noout_julia[even_indices_julia, :]\n\nlinear_model_half_julia = lm(formula_all_julia, birthwt_in_julia)\nprintln(coeftable(linear_model_half_julia))\n\n# Prediction on training data\nbirthwt_predict_in_julia = GLM.predict(linear_model_half_julia, birthwt_in_julia)\nprintln(cor(birthwt_in_julia.birthwt_grams, birthwt_predict_in_julia))\n\nPlots.scatter(birthwt_in_julia.birthwt_grams, birthwt_predict_in_julia, 
              xlabel=\"Actual Birth Weight (g)\", ylabel=\"Predicted Birth Weight (g)\",\n              title=\"Prediction on Training Data\", legend=false)\nsavefig(\"birthwt_predict_in_plot.pdf\")\n\n# Prediction on test data\nbirthwt_predict_out_julia = GLM.predict(linear_model_half_julia, birthwt_out_julia)\nprintln(cor(birthwt_out_julia.birthwt_grams, birthwt_predict_out_julia))\n\nPlots.scatter(birthwt_out_julia.birthwt_grams, birthwt_predict_out_julia, 
              xlabel=\"Actual Birth Weight (g)\", ylabel=\"Predicted Birth Weight (g)\",\n              title=\"Prediction on Test Data\", legend=false)\nsavefig(\"birthwt_predict_out_plot.pdf\")\n